<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tombola 'N dialette fruselunese</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            margin: 0; 
            padding: 0; 
            font-family: system-ui, -apple-system, sans-serif;
        }
        
        @keyframes snow-fall-left {
            0% { transform: translateY(-10px) translateX(0) rotate(0deg); }
            100% { transform: translateY(100vh) translateX(30px) rotate(360deg); }
        }
        
        @keyframes snow-fall-right {
            0% { transform: translateY(-10px) translateX(0) rotate(0deg); }
            100% { transform: translateY(100vh) translateX(-30px) rotate(-360deg); }
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        
        .snow-left {
            position: fixed;
            top: -10px;
            left: 0;
            width: 5%;
            font-size: 1.5em;
            animation: snow-fall-left linear infinite;
            pointer-events: none;
            z-index: 1000;
        }
        
        .snow-right {
            position: fixed;
            top: -10px;
            right: 0;
            width: 5%;
            font-size: 1.5em;
            animation: snow-fall-right linear infinite;
            pointer-events: none;
            z-index: 1000;
        }
        
        .star {
            position: fixed;
            color: gold;
            font-size: 1.2em;
            animation: twinkle 2s ease-in-out infinite;
            pointer-events: none;
            z-index: 999;
        }
        
        .star-left {
            left: 0;
            width: 5%;
        }
        
        .star-right {
            right: 0;
            width: 5%;
        }
        
        .visit-counter {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #dc2626, #991b1b);
            color: white;
            padding: 12px 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            font-weight: bold;
            font-size: 16px;
            z-index: 1001;
            border: 3px solid #fbbf24;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <!-- Contatore visite esterno con CountAPI -->
    <div class="visit-counter">
        üé≤ Partite giocate: <span id="visits">...</span>
    </div>

    <script>
        // Incrementa il contatore ad ogni caricamento della pagina
        fetch('https://api.countapi.xyz/hit/tombola-frosinone/partite')
            .then(response => response.json())
            .then(data => {
                document.getElementById('visits').textContent = data.value;
            })
            .catch(error => {
                console.error('Errore contatore:', error);
                document.getElementById('visits').textContent = '---';
            });
    </script>

    <script type="text/babel">
        const { useState, useRef } = React;

        const Volume2 = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>;
        const VolumeX = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><line x1="23" y1="9" x2="17" y2="15"></line><line x1="17" y1="9" x2="23" y2="15"></line></svg>;
        const RotateCcw = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="1 4 1 10 7 10"></polyline><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path></svg>;
        const Sparkles = ({size}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"></path><path d="M5 3v4"></path><path d="M19 17v4"></path><path d="M3 5h4"></path><path d="M17 19h4"></path></svg>;

        const TombolaGame = () => {
            const [extractedNumbers, setExtractedNumbers] = useState([]);
            const [currentNumber, setCurrentNumber] = useState(null);
            const [isAnimating, setIsAnimating] = useState(false);
            const [audioEnabled, setAudioEnabled] = useState(true);
            const [isFullscreen, setIsFullscreen] = useState(false);
            const [isPlayingAudio, setIsPlayingAudio] = useState(false);
            const audioRef = useRef(null);
            const extractionInProgress = useRef(false);

            const smorfiaFrusinate = {
                1: "Glie Campanile", 2: "Le cioce", 3: "Santa Fregna", 4: "La Ciuciar√¨a", 5: "Rizziero",
                6: "Glie str√πmmele", 7: "La glippa", 8: "Glie cungone", 9: "Cecaturde", 10: "Sagne i faciole",
                11: "La radeca", 12: "Glie faone", 13: "Sant'Antonie", 14: "Maria Necola", 15: "Glie Distrette",
                16: "Funtana De Carolis", 17: "Le Funtanelle", 18: "La Cosa", 19: "Glie Schioppe", 20: "Ss. Suluerie i Rumisda",
                21: "Banda Romagnoli", 22: "Le carruzzette", 23: "Buce de cule", 24: "Anfiteatre Abbelate", 25: "Natale",
                26: "Glie cuccetieglie", 27: "San Paganine", 28: "L'abbalia", 29: "Brauante", 30: "Gli fine fine",
                31: "Glie mischiette de Magale", 32: "La Pruincia", 33: "I fratelli Catalano", 34: "Maniane", 35: "La Santissema",
                36: "Sante Glibbratore", 37: "Madonna della Glibbra", 38: "Glie Dispenzarie", 39: "La Uia Noua", 40: "Curva Zallocche",
                41: "Funtana Bussi", 42: "La Tipugrafeca", 43: "La Scola Tirauante", 44: "Colle Campagiorne", 45: "Piazza dell'Erua",
                46: "Uia de glie Carbunare", 47: "Colle Cutturine", 48: "Burgitte", 49: "Glie Grattaci√©le", 50: "Brunella",
                51: "Glie Tunnele", 52: "Ponte La Funtana", 53: "La Mola Uecchia", 54: "Glie Matusa", 55: "Gli'urganette",
                56: "Glie cutef√π", 57: "Glie ciufalitte", 58: "Glie saltarelle", 59: "Gli zampugnare", 60: "Ustaria De Matteise",
                61: "Glie stunneture", 62: "La scifa", 63: "Glie sgummarieglie", 64: "Glie serieglie", 65: "Glie sericchie",
                66: "Glie falecone", 67: "Glie fallone", 68: "Glie tutere", 69: "A capecule", 70: "Gli sime calate",
                71: "Glie strunze", 72: "Uia de glie cacature", 73: "L'Ammazzatora", 74: "Glie Giardine", 75: "Santa Glisabbetta",
                76: "Porta Romana", 77: "Glie Beluedere", 78: "Patacca", 79: "Piazza Garebalde", 80: "Glie Munumente",
                81: "Sciampionn√©", 82: "Fignuitte", 83: "Cattac√©ca", 84: "Gl'Amute", 85: "Tittine",
                86: "'Mbriachella", 87: "Gli Pelune", 88: "Madonna de la Cercia", 89: "La St√©cena", 90: "La uermenara"
            };

            
            const speakNumber = (num) => {
                if (!audioEnabled || isPlayingAudio) return;
                
                if (audioRef.current) {
                    audioRef.current.pause();
                    audioRef.current.currentTime = 0;
                    audioRef.current = null;
                }
                
                setIsPlayingAudio(true);
                
                const timestamp = new Date().getTime();
                const mp3Url = `https://braluc48-create.github.io/Tombula-fruselunese/${num}.mp3?t=${timestamp}`;
                const audio = new Audio(mp3Url);
                audioRef.current = audio;
                
                audio.onended = () => {
                    setIsPlayingAudio(false);
                    audioRef.current = null;
                };
                
                audio.onerror = (err) => {
                    console.error('Errore riproduzione MP3:', err);
                    setIsPlayingAudio(false);
                    audioRef.current = null;
                    
                    if (window.speechSynthesis) {
                        const utterance = new SpeechSynthesisUtterance();
                        utterance.text = `Numero ${num}. ${smorfiaFrusinate[num]}`;
                        utterance.lang = 'it-IT';
                        utterance.rate = 0.9;
                        window.speechSynthesis.speak(utterance);
                    }
                };
                
                audio.play().catch(err => {
                    console.error('Errore play:', err);
                    setIsPlayingAudio(false);
                    audioRef.current = null;
                });
            };

            const extractNumber = () => {
                if (extractedNumbers.length === 90 || isAnimating || extractionInProgress.current) {
                    return;
                }
                
                extractionInProgress.current = true;
                
                const availableNumbers = Array.from({length: 90}, (_, i) => i + 1)
                    .filter(n => !extractedNumbers.includes(n));
                const randomNum = availableNumbers[Math.floor(Math.random() * availableNumbers.length)];
                
                setIsAnimating(true);
                setCurrentNumber(randomNum);
                
                setTimeout(() => {
                    setExtractedNumbers([...extractedNumbers, randomNum]);
                    setIsAnimating(false);
                    extractionInProgress.current = false;
                    speakNumber(randomNum);
                }, 1000);
            };

            const reset = () => {
                if (audioRef.current) {
                    audioRef.current.pause();
                    audioRef.current.currentTime = 0;
                    audioRef.current = null;
                }
                setIsPlayingAudio(false);
                extractionInProgress.current = false;
                setExtractedNumbers([]);
                setCurrentNumber(null);
            };

            const toggleFullscreen = () => {
                setIsFullscreen(!isFullscreen);
            };

            const generateBoard = () => {
                return [
                    [1, 2, 3, 4, 5, 11, 12, 13, 14, 15, 21, 22, 23, 24, 25],
                    [6, 7, 8, 9, 10, 16, 17, 18, 19, 20, 26, 27, 28, 29, 30],
                    [31, 32, 33, 34, 35, 41, 42, 43, 44, 45, 51, 52, 53, 54, 55],
                    [36, 37, 38, 39, 40, 46, 47, 48, 49, 50, 56, 57, 58, 59, 60],
                    [61, 62, 63, 64, 65, 71, 72, 73, 74, 75, 81, 82, 83, 84, 85],
                    [66, 67, 68, 69, 70, 76, 77, 78, 79, 80, 86, 87, 88, 89, 90]
                ];
            };

            const boardQuindicine = generateBoard();
            const getImagePath = (num) => `https://braluc48-create.github.io/Tombula-fruselunese/${num}.jpg`;

            return (
                <div className="min-h-screen bg-gradient-to-br from-red-900 via-red-800 to-green-900 p-4">
                    {[...Array(6)].map((_, i) => (
                        <div key={`snow-left-${i}`} className="snow-left" 
                             style={{left: `${Math.random() * 4}%`, animationDuration: `${6 + Math.random() * 8}s`, animationDelay: `${Math.random() * 5}s`}}>‚ùÑÔ∏è</div>
                    ))}
                    {[...Array(6)].map((_, i) => (
                        <div key={`snow-right-${i}`} className="snow-right" 
                             style={{right: `${Math.random() * 4}%`, left: 'auto', animationDuration: `${6 + Math.random() * 8}s`, animationDelay: `${Math.random() * 5}s`}}>‚ùÑÔ∏è</div>
                    ))}
                    {[...Array(4)].map((_, i) => (
                        <div key={`star-left-${i}`} className="star star-left" 
                             style={{left: `${Math.random() * 4}%`, top: `${Math.random() * 100}%`, animationDelay: `${Math.random() * 2}s`}}>‚ú®</div>
                    ))}
                    {[...Array(4)].map((_, i) => (
                        <div key={`star-right-${i}`} className="star star-right" 
                             style={{right: `${Math.random() * 4}%`, left: 'auto', top: `${Math.random() * 100}%`, animationDelay: `${Math.random() * 2}s`}}>‚ú®</div>
                    ))}
                    
                    <div className="max-w-7xl mx-auto mb-4 md:mb-6 text-center">
                        <div className="bg-gradient-to-r from-blue-700 via-blue-500 to-blue-700 rounded-t-2xl border-4 border-t-4 border-x-4 border-yellow-400 relative overflow-hidden" style={{minHeight: '250px'}}>
                            <img src="https://braluc48-create.github.io/Tombula-fruselunese/frosinone.jpg" alt="Frosinone panorama" 
                                 className="absolute inset-0 w-full h-full object-cover opacity-60" style={{filter: 'brightness(1.3)'}} onError={(e) => {e.target.style.display = 'none'}} />
                            <img src="https://braluc48-create.github.io/Tombula-fruselunese/LogoOtovision.jpg" alt="Logo Otovision" 
                                 className="absolute top-2 left-2 md:top-4 md:left-4 w-20 md:w-32 h-auto object-contain z-20 drop-shadow-lg" onError={(e) => {e.target.style.display = 'none'}} />
                            <img src="https://braluc48-create.github.io/Tombula-fruselunese/logo.png" alt="Logo gruppo dialetto" 
                                 className="absolute top-2 right-2 md:top-4 md:right-4 w-16 md:w-24 h-16 md:h-24 object-contain z-20 drop-shadow-lg" onError={(e) => {e.target.style.display = 'none'}} />
                            
                            <div className="relative z-10 py-12 md:py-16">
                                <div className="text-3xl md:text-6xl font-black text-white mb-1 md:mb-2 absolute right-24 md:right-40 top-1/2 transform -translate-y-1/2" style={{textShadow: '4px 4px 8px rgba(0,0,0,0.7)'}}>FRUSENONE</div>
                            </div>
                        </div>
                        <div className="bg-white/10 backdrop-blur-sm rounded-b-2xl p-3 md:p-4 border-4 border-b-4 border-x-4 border-yellow-400 shadow-2xl">
                            <div className="flex items-center justify-center gap-2 md:gap-4 mb-1 md:mb-2">
                                <Sparkles size={24} />
                                <h1 className="text-2xl md:text-5xl font-bold text-white" style={{textShadow: '3px 3px 0 #b91c1c, -1px -1px 0 #15803d'}}>‚ùÑÔ∏è TOMBOLA ‚õÑ</h1>
                                <Sparkles size={24} />
                            </div>
                            <p className="text-yellow-200 text-lg md:text-2xl font-bold">'N dialette fruselunese</p>
                        </div>
                    </div>

                    <div className="max-w-7xl mx-auto mb-4 md:mb-6 flex gap-2 md:gap-4 justify-center flex-wrap px-2 items-center">
                        <button onClick={extractNumber} disabled={extractedNumbers.length === 90 || isAnimating || isPlayingAudio}
                            className="bg-green-600 hover:bg-green-700 disabled:bg-gray-600 text-white font-bold py-3 md:py-4 px-4 md:px-8 rounded-xl shadow-lg transform transition hover:scale-105 text-base md:text-xl">
                            üé≤ Caccia 'ne nummere
                        </button>
                        <button onClick={reset} className="bg-red-600 hover:bg-red-700 text-white font-bold py-3 md:py-4 px-4 md:px-6 rounded-xl shadow-lg transform transition hover:scale-105 flex items-center gap-2 text-base md:text-xl">
                            <RotateCcw /> Reset
                        </button>
                        <button onClick={() => setAudioEnabled(!audioEnabled)}
                            className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 md:py-4 px-4 md:px-6 rounded-xl shadow-lg transform transition hover:scale-105 flex items-center gap-2 text-base md:text-xl">
                            {audioEnabled ? <Volume2 /> : <VolumeX />}
                        </button>
                        <button onClick={toggleFullscreen}
                            className="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 md:py-4 px-4 md:px-6 rounded-xl shadow-lg transform transition hover:scale-105 text-base md:text-xl">üìã TABELLONE</button>
                    </div>

                    {currentNumber && (
                        <div className="max-w-7xl mx-auto mb-4 md:mb-6 px-2">
                            <div className={`bg-white rounded-3xl p-4 md:p-8 shadow-2xl border-4 md:border-8 border-yellow-400 text-center ${isAnimating ? 'animate-bounce' : ''}`}>
                                <div className="mb-4 md:mb-6 rounded-2xl overflow-hidden border-2 md:border-4 border-red-700 mx-auto bg-gray-200" style={{maxWidth: '500px'}}>
                                    <img src={getImagePath(currentNumber)} alt={smorfiaFrusinate[currentNumber]} className="w-full h-auto object-contain"
                                        onError={(e) => {e.target.style.display = 'none'; e.target.parentElement.innerHTML = '<div style="display:flex;align-items:center;justify-center;height:250px;font-size:2em;color:#666;">üì∑</div>';}} />
                                </div>
                                <div className="text-6xl md:text-8xl font-bold text-red-700 mb-2 md:mb-4">{currentNumber}</div>
                                <div className="text-xl md:text-3xl text-gray-700 font-semibold">{smorfiaFrusinate[currentNumber]}</div>
                                <div className="mt-2 md:mt-4 text-base md:text-xl text-gray-600">Estratti: {extractedNumbers.length}/90</div>
                            </div>
                        </div>
                    )}

                    {extractedNumbers.length > 0 && (
                        <div className="max-w-7xl mx-auto mb-4 md:mb-6 px-2">
                            <div className="bg-yellow-400 rounded-2xl p-4 md:p-6 shadow-2xl border-2 md:border-4 border-yellow-600">
                                <h2 className="text-lg md:text-2xl font-bold text-center mb-3 md:mb-4 text-red-700">üìã ESTRATTI: {extractedNumbers.length}/90</h2>
                                <div className="flex flex-wrap gap-1.5 md:gap-2 justify-center">
                                    {extractedNumbers.map(num => (
                                        <div key={num} className="bg-red-600 text-white px-2 md:px-4 py-1 md:py-2 rounded-lg font-bold text-base md:text-xl shadow-md">{num}</div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}

                    <div className={`${isFullscreen ? 'fixed inset-0 z-50 bg-gradient-to-br from-red-900 via-red-800 to-green-900 overflow-auto' : ''}`}>
                        {isFullscreen && (
                            <div className="fixed top-4 left-0 right-0 z-50 flex justify-between px-4">
                                <button onClick={extractNumber} disabled={extractedNumbers.length === 90 || isAnimating || isPlayingAudio}
                                    className="bg-green-600 hover:bg-green-700 disabled:bg-gray-600 text-white font-bold py-3 px-6 rounded-xl shadow-lg">üé≤ Caccia 'ne nummere</button>
                                <button onClick={toggleFullscreen} className="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-xl shadow-lg">‚úï Chiudi</button>
                            </div>
                        )}
                        <div className={`${isFullscreen ? 'p-8 pt-24' : 'max-w-7xl mx-auto mb-8'}`}>
                            {isFullscreen && currentNumber && (
                                <div className="mb-6">
                                    <div className={`bg-white rounded-3xl p-6 shadow-2xl border-8 border-yellow-400 text-center ${isAnimating ? 'animate-bounce' : ''}`}>
                                        <div className="flex gap-6">
                                            <div className="flex-1 rounded-2xl overflow-hidden border-4 border-red-700 bg-gray-200" style={{maxWidth: '400px'}}>
                                                <img src={getImagePath(currentNumber)} alt={smorfiaFrusinate[currentNumber]} className="w-full h-auto object-contain"
                                                    onError={(e) => {e.target.style.display = 'none'; e.target.parentElement.innerHTML = '<div style="display:flex;align-items:center;justify-center;height:300px;font-size:2em;color:#666;">üì∑</div>';}} />
                                            </div>
                                            <div className="flex-1 flex flex-col justify-center">
                                                <div className="text-8xl font-bold text-red-700 mb-2">{currentNumber}</div>
                                                <div className="text-3xl text-gray-700 font-semibold">{smorfiaFrusinate[currentNumber]}</div>
                                                <div className="mt-4 text-xl text-gray-600">Estratti: {extractedNumbers.length}/90</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}
                            <div className="bg-white rounded-2xl p-3 md:p-6 shadow-2xl border-2 md:border-4 border-red-700">
                                <h2 className="text-xl md:text-3xl font-bold text-center mb-3 md:mb-6 text-red-700">üìã GLIE TABELLONE</h2>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-6">
                                    {boardQuindicine.map((quindicina, qIdx) => (
                                        <div key={qIdx} className="border-2 md:border-4 border-blue-500 rounded-xl p-2 md:p-4 bg-blue-50">
                                            <div className="grid grid-cols-5 gap-1 md:gap-2">
                                                {quindicina.map(num => {
                                                    const isExtracted = extractedNumbers.includes(num);
                                                    return (
                                                        <div key={num} style={{
                                                            backgroundColor: isExtracted ? '#dc2626' : '#f3f4f6',
                                                            color: isExtracted ? 'white' : '#1f2937',
                                                            borderWidth: isExtracted ? '3px' : '2px',
                                                            borderStyle: 'solid',
                                                            borderColor: isExtracted ? '#991b1b' : '#9ca3af',
                                                            boxShadow: isExtracted ? '0 10px 15px -3px rgba(0, 0, 0, 0.5), 0 0 0 3px #fbbf24, 0 0 0 5px #991b1b' : 'none',
                                                            transform: isExtracted ? 'scale(1.05)' : 'scale(1)',
                                                            transition: 'all 0.3s'
                                                        }} className="flex flex-col items-center justify-center p-1 md:p-2 rounded-lg min-h-[70px] md:min-h-[110px] relative overflow-hidden">
                                                            <img src={getImagePath(num)} alt={smorfiaFrusinate[num]} 
                                                                 className="absolute inset-0 w-full h-full object-cover opacity-75"
                                                                 onError={(e) => {e.target.style.display = 'none'}} />
                                                            
                                                            <div className="absolute top-0.5 left-0.5 md:top-1 md:left-1 text-lg md:text-2xl font-black z-10 bg-white/90 px-1 md:px-2 py-0.5 md:py-1 rounded" 
                                                                 style={{color: '#1f2937'}}>{num}</div>
                                                            
                                                            <div className="text-[0.45rem] md:text-[0.6rem] text-center font-semibold leading-tight mt-auto relative z-10"
                                                                 style={{
                                                                     color: isExtracted ? 'white' : '#1f2937',
                                                                     textShadow: isExtracted ? '1px 1px 2px rgba(0,0,0,0.8)' : '1px 1px 1px rgba(255,255,255,0.8)'
                                                                 }}>
                                                                {smorfiaFrusinate[num]}
                                                            
